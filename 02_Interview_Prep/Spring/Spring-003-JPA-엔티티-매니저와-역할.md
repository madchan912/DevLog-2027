# [JPA] 엔티티 매니저(Entity Manager)란 무엇일까요?

## ❓ Question

JPA의 핵심인 엔티티 매니저(Entity Manager)는 무엇이며, 어떤 역할을 수행하나요?

---

### 💡 Version 1: 핵심 요약 답변 (1분)

> **엔티티 매니저**는 JPA에서 엔티티를 관리하는 **실질적인 역할자**입니다. 데이터베이스와 애플리케이션 사이에서 **'영속성 컨텍스트(Persistence Context)'** 라는 임시 저장소를 다루며, 엔티티의 생명주기를 관리합니다.
>
> 마치 쇼핑객(`엔티티 매니저`)이 장바구니(`영속성 컨텍스트`)에 물건(`엔티티`)을 담고(`persist`), 조회하고(`find`), 빼고(`detach`), 교체하고(`merge`), 버리는(`remove`) 모든 행위를 담당하는 것과 같습니다. 이 과정을 통해 **1차 캐시, 쓰기 지연, 변경 감지** 등의 성능 이점을 얻을 수 있습니다.

---

### 📚 Version 2: 심화 상세 답변 (Deep Dive)

> **엔티티 매니저(Entity Manager)**는 엔티티의 영속성을 관리하는 JPA의 핵심 인터페이스입니다. 엔티티 매니저를 이해하기 위해선 먼저 **'영속성 컨텍스트'**와 **'엔티티의 생명주기'**를 알아야 합니다.
>
> **1️⃣ 영속성 컨텍스트 (Persistence Context)**
>
> -   '엔티티를 영구 저장하는 환경'으로, 엔티티 매니저에 의해 관리되는 논리적인 작업 공간(임시 저장소)입니다.
> -   **주요 특징:**
>     -   **1차 캐시:** 조회한 엔티티를 저장하여, 동일한 트랜잭션 내에서 반복 조회가 발생하면 DB 대신 캐시에서 반환합니다.
>     -   **쓰기 지연(Transactional Write-Behind):** `persist`된 엔티티나 변경된 엔티티에 대한 SQL을 즉시 실행하지 않고 '쓰기 지연 SQL 저장소'에 모아뒀다가, 트랜잭션이 커밋될 때 한 번에 실행합니다.
>     -   **변경 감지(Dirty Checking):** 1차 캐시에 저장된 최초 상태(스냅샷)와 현재 엔티티를 비교하여, 변경이 감지되면 트랜잭션 커밋 시 UPDATE 쿼리를 자동으로 생성합니다.
>
> **2️⃣ 엔티티 매니저가 관리하는 엔티티의 4가지 상태 (생명주기)**
>
> 엔티티는 영속성 컨텍스트와 맺는 관계에 따라 4가지 상태를 가지며, 엔티티 매니저의 메서드를 통해 상태가 전이됩니다.
>
> -   **비영속 (Transient):** `new Member()` 처럼 순수하게 객체를 생성한 상태. JPA와 아무 관련이 없습니다.
>
> -   **영속 (Managed):** `em.persist()` 또는 `em.find()`를 통해 엔티티가 영속성 컨텍스트에 저장되어 관리받는 상태. 1차 캐시, 변경 감지 등의 혜택을 받습니다.
>
> -   **준영속 (Detached):** `em.detach()`, `em.clear()`, `em.close()` 등으로 영속성 컨텍스트가 관리하던 엔티티가 관리 대상에서 벗어난 상태. 더 이상 JPA의 지원을 받지 못합니다.
>
> -   **삭제 (Removed):** `em.remove()`를 통해 엔티티가 영속성 컨텍스트와 1차 캐시에서 삭제된 상태. 트랜잭션 커밋 시 DB에서도 DELETE 쿼리가 실행됩니다.
>
> **3️⃣ 주요 메서드 역할 요약**
>
> * `em.persist(entity)`: 엔티티를 **영속** 상태로 만듭니다. (INSERT 준비)
> * `em.find(type, id)`: ID로 엔티티를 조회하여 **영속** 상태로 가져옵니다. (SELECT)
> * `em.remove(entity)`: **영속** 상태의 엔티티를 **삭제** 상태로 만듭니다. (DELETE 준비)
> * `em.detach(entity)`: **영속** 상태의 엔티티를 **준영속** 상태로 만듭니다.
> * `em.merge(entity)`: **준영속** 상태의 엔티티를 받아, 그 내용을 기반으로 새로운 **영속** 객체를 반환합니다. (UPDATE 준비)
>
> 이처럼 엔티티 매니저는 영속성 컨텍스트라는 작업 공간을 활용하여 엔티티의 생명주기를 체계적으로 관리함으로써, 개발자가 객체지향적으로 비즈니스 로직에 집중할 수 있도록 돕는 핵심적인 역할을 수행합니다.