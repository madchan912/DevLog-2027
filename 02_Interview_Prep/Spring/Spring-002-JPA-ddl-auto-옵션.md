# [JPA] ddl-auto 옵션 완벽 가이드

## ❓ Question

JPA의 `ddl-auto` 옵션은 각각 어떤 동작을 하고, 어떤 상황에서 사용해야 하나요? 특히 운영 환경에서는 어떻게 스키마를 관리해야 할까요?

---

### 💡 Version 1: 핵심 요약 답변 (1분)

> `ddl-auto`는 JPA 구현체(Hibernate)가 엔티티 클래스를 기준으로 데이터베이스 스키마를 자동으로 관리하는 방법을 설정하는 옵션입니다. 각 옵션은 개발 단계와 목적에 따라 선택해야 합니다.
>
> * **`create`, `create-drop` (개발용):** 애플리케이션 실행 시 스키마를 완전히 초기화합니다. 모든 데이터가 삭제되므로 테스트나 개발 극초기에만 사용합니다.
>
> * **`update` (개발용):** 엔티티의 변경사항을 기존 스키마에 반영(ADD 등)합니다. 편리하지만 컬럼 삭제나 복잡한 변경은 처리하지 못하며, 운영 환경에서는 예기치 않은 문제를 일으킬 수 있어 절대 사용하지 않습니다.
>
> * **`validate` (개발/운영용):** 엔티티와 스키마가 일치하는지 검증만 합니다. 불일치 시 애플리케이션을 시작하지 않아 잠재적 오류를 막는 안전한 옵션입니다.
>
> * **`none` (운영용):** 스키마 관리에 전혀 관여하지 않습니다. 가장 안전한 옵션입니다.
>
> **결론적으로, 운영 환경에서는 `none` 또는 `validate`를 사용하고, 스키마 변경은 Flyway나 Liquibase 같은 데이터베이스 마이그레이션 도구를 통해 안전하고 체계적으로 관리해야 합니다.**

---

### 📚 Version 2: 심화 상세 답변 (Deep Dive)

> `ddl-auto`는 애플리케이션의 엔티티 모델과 데이터베이스의 실제 스키마를 동기화하는 방법을 결정하는 Hibernate 설정입니다. 각 옵션은 개발 라이프사이클의 특정 단계에 맞춰 명확한 장단점을 가집니다.

#### **파괴적인 옵션 (데이터가 삭제됨)**

##### 1. `create`
* **동작:** 애플리케이션 시작 시, 기존 스키마(테이블 등)를 모두 **`DROP`** 하고 엔티티 정의에 따라 새로 **`CREATE`** 합니다.
* **특징:** 실행할 때마다 모든 데이터가 사라집니다.
* **주 사용처:** 프로젝트 극초기 단계, 매번 깨끗한 데이터베이스가 필요할 때, 혹은 H2 같은 인메모리 DB와 함께 테스트할 때 사용합니다.

##### 2. `create-drop`
* **동작:** `create`와 동일하게 시작 시 스키마를 삭제 후 생성하며, 추가로 애플리케이션 **종료 시점**에 생성했던 스키마를 다시 **`DROP`** 합니다.
* **특징:** 애플리케이션이 실행되는 동안에만 스키마와 데이터가 존재합니다.
* **주 사용처:** 매번 독립적인 환경이 보장되어야 하는 단위 테스트(Unit Test)나 통합 테스트(Integration Test)에 가장 이상적입니다.

#### **수정 또는 검증 옵션 (데이터 보존)**

##### 3. `update`
* **동작:** 엔티티와 스키마를 비교하여, 엔티티의 변경분을 반영하기 위해 스키마를 변경(**`ALTER TABLE`** 등)합니다.
* **특징:** 엔티티에 필드를 추가하면 DB에 컬럼이 추가되지만, 필드를 삭제해도 **컬럼은 삭제되지 않습니다.** 데이터 유실을 막기 위함이며, 이로 인해 스키마 관리가 복잡해질 수 있습니다.
* **주 사용처:** 개인 프로젝트나 개발 초기 단계에서 간단한 변경을 빠르게 적용하고 싶을 때 유용합니다. **운영 환경에서는 절대 사용하면 안 됩니다.**

##### 4. `validate`
* **동작:** 엔티티와 스키마가 정확히 일치하는지 **검증만** 합니다. 스키마를 절대 변경하지 않습니다.
* **특징:** 만약 스키마와 엔티티가 다를 경우, 에러를 발생시키고 애플리케이션 실행을 중단시킵니다.
* **주 사용처:** 개발 환경에서 스키마 변경을 깜빡했는지 확인할 때, 또는 운영 환경에서 배포된 코드와 DB 스키마의 정합성을 보장하고 싶을 때 사용되는 안전한 옵션입니다.

#### **비활성 옵션**

##### 5. `none`
* **동작:** `ddl-auto` 기능을 완전히 끕니다. 스키마 관리에 JPA가 전혀 관여하지 않습니다.
* **특징:** 가장 안전하고 보수적인 옵션입니다.
* **주 사용처:** 스키마를 DBA나 마이그레이션 도구를 통해 100% 수동으로 관리하는 **운영 환경**에서 주로 사용됩니다.

---

### 🚀 운영 환경에서의 스키마 관리 전략

운영 환경에서 `update` 같은 자동화 옵션을 사용하면 예측 불가능한 변경, 대용량 테이블에서의 서비스 중단, 데이터 유실 등의 심각한 장애를 유발할 수 있습니다. 따라서 다음과 같은 **데이터베이스 마이그레이션 도구**를 사용하는 것이 표준적인 방법입니다.

* **Flyway:** SQL 파일을 기반으로 스키마 버전을 관리합니다. 배우기 쉽고 직관적이며, 작성된 SQL이 그대로 실행되어 DBA가 관리하기에 용이합니다.
* **Liquibase:** XML, YAML, JSON 등 보다 추상적인 형식으로 변경사항을 기록합니다. 특정 데이터베이스에 종속되지 않는 스크립트를 작성할 수 있는 장점이 있습니다.

이러한 도구들은 Git으로 코드 버전을 관리하듯, SQL 스크립트로 데이터베이스 스키마의 변경 이력을 체계적으로 관리하게 해 주어 안전하고 신뢰성 있는 운영을 가능하게 합니다.

#### **환경별 추천 전략 요약**

| 환경 | 추천 ddl-auto 옵션 | 스키마 변경 방법 |
| :--- | :--- | :--- |
| **로컬/개인 개발** | `create`, `update` | ddl-auto에 맡김 |
| **팀 개발/테스트 서버** | `validate`, `none` | **마이그레이션 도구 (Flyway 등)** |
| **운영 서버** | **`none`, `validate`** | **마이그레이션 도구** 또는 DBA 수동 관리 |